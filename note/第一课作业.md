
## 1. 修正input中$parent写法的问题

参考 ElementUi 后

**第一步** -- utils增加文件mixin

```
# src/utils/mixin.js

export default {
    methods: {        
        // 循环向上寻找指定名称的父组件，找到后在该组件上发布事件
        dispatch(targetCompName, eventName, payload) {
            let parentComp = this.$parent;
            while (this.$parent && this.$parent.$options.componentName !== targetCompName) {
                parentComp = this.$parent;
            }
            parentComp && parentComp.$emit(eventName, payload);
        },
    },
}
```

**第二步** -- KInput中onInput修改

```
# src/components/form/KInput.vue

// 同样引入mixin
import mixin from '@/utils/mixin'

<script>
    mixins: [mixin],
    methods: {
        onInput(e) {
            this.$emit('input', e.target.value)

            // 实时校验，通知父组件
            // this.$parent.$emit('validate')      // 作业1：不用$parent降低耦合
            this.dispatch('KFormItem', 'validate')  // 通知方法修改
        }
    }

    ...
</script>
```

## 2. 使用Vue.extend方式实现create

**第一步** -- 新增文件src/utils/create-extend.js

```
# src/utils/create-extend.js

import Vue from 'vue'

export function create(component, props) {

    // 创建组件的构造函数
    let vmConstruct = Vue.extend(Object.assign({}, component, {data: () => props}))

    // 实例化，生成dom
    let comp = new vmConstruct().$mount()

    // 插入body
    document.body.appendChild(comp.$el);    
    
    // 因为用Vue.extend生成的是组件构造函数，实例化之后就是根组件（并不是根实例，不需要comp.$children[0]）
    // 销毁方法
    comp.remove = () => {
        document.body.removeChild(comp.$el)
        comp.$destroy()
    }

    return comp;
}
```

**第二步** -- Notice组件稍微调整，将部分prop属性移到data中。因为prop和data存在相同属性会冲突

```
# src/components/Notice.vue

export default {
    // props: {
    //     title: String,
    //     message: String,
    //     duration: {
    //         type: Number,
    //         default: 2000,
    //     },
    // },
    data() {
        return {
            showNotice: false,      
            title: '',
            message: '',
            duration: 3000,
        }
    },

...
```

**第三步** -- main.js中修改调用文件

```
# src/main.js

import {create} from '@/utils/create-extend'

...
```

